# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, которые используются в приложении
Карточка товара

```
interface IProduct {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  price: number;
}
```

Данные пользователя

```
interface IUser {
  email: string;
  phone: number;
  address: string;
  payment: string;
}
```

Интерфейс для модели коллекции карточек

```
interface IProductsData {
  setproducts(items: IProduct[]): void;
	getproduct(productID: string): IProduct;
	setPreview(productID: string): void;
}
```

Данные корзины для работы корзины товаров

```
export type TBasketItem = Pick<IProduct, 'id' | 'price'>
```

Интерфейс для модели коллекции карточек в корзине

```
interface IBasketData {
  actionWithProduct(product: IProduct): void;
	getProducts(): TBasketItem[];
	getSumPrice(): number;
	getInBasket(itemID: string): boolean;
	clearBasket(): void;
}
```

Данные для валидации формы пользователя

```
type TFormErrors = Partial<IUser>;
```

Интерфейс для модели данных заказа

```
interface IOrder extends IUser {
	total: number;
	items: string[];
}
```

Данные получаемые от сервера при валидной отправке заказа

```
interface IOrderResult {
    id: string;
    total: number;
}
```

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице;
- слой данных, отвечает за хранение и изменение данныхж;
- презентер, отвечает за связь слоев представления и данных.

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component
Абстрактный класс содержит в себе методы для работы с разметкой классов отображения. Позволяет не дублировать в каждом классе отображения действия с разметкой. В конструкторе принимает при наследовании контейнер из класса отображения.
Методы:
- setText(element: HTMLElement, value: unknown) - метод для изменения текста в элементе разметки  
- setImage(element: HTMLImageElement, value: string, alt?: string) - метод для изменения в элементе разметки изображения
- setDisabled(element: HTMLElement, state: boolean) - метод для блокировки взаимодействия с элементом разметки
- toggleClass(element: HTMLElement, className: string, force?: boolean) - метод для переключения класса у элемента в зависимости от того, есть ли класс у элемента
- render(data?: Partial<T>): HTMLElement - метод для отображения содержимого контейнера. 

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов карточек товаров
- preview: string | null - id карточки, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setproducts(items: IProduct[]): void - метод для сохранения карточек товаров
- getproduct(productID: string): IProduct - возвращает карточку по ее id
- setPreview(item: IProduct): void - сохраняет ID выбранной карточки в поле preview
- а также геттер для получения данных.

#### Класс UserData
Класс отвечает за хранение и логику работы с данными пользователя.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- user: IUser - данные пользователя
- formErrors: TFormErrors - для хранения ошибок валидации данных пользователя
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setUserData(field: keyof IUser, value: string): void - сохраняет данные пользователя в классе. Принимает атрибут name формы для валидации данных
- getUserData(): IUser - возвращает данные пользователя
- validateUser(): boolean - проверяет заполнение данных пользователя и при отстуствие данных заполняет поле класса formErrors
- clearUser(): void - удаление данных пользователя.

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- products: TBasketItem[] - массив товаров, добавленных в корзину
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- actionWithProduct(product: IProduct): void - добавление товара в корзину или удаление, если товар был ранее добавлен 
- getProducts(): TBasketItem[] - возвращение массива товаров, добавленных в корзину
- getSumPrice(): number - возвращение общей стоимости добавленных товаров
- getInBasket(itemID: string): boolean - метод для проверки добавления товара в корзину
- getIndexProduct(product: IProduct): number - возвращает порядковый номер добавленного товара в корзине
- clearBasket(): void - удаление товаров из корзины, после успешного заказа.

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
В полях класса хранятся следующие данные:
- order: IOrder - объект, в котором храниться заказ пользователя.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setOrder(user: IUser, product: TBasketItem[]) - сохранение данных о заказе в поле order
- getOrder(): IOrder - возвращение заказа
- clearOrder(): void - удаление данных о заказе.

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных. Все классы наследуют абстрактный класс Component, кроме наследуемых классов.

#### Класс Modal
Реализует модальное окно. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\  
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает родительский контейнер модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- _content: HTMLElement - элемент разметки, в который будет происходить добавление темплейта
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
- content: HTMLElement - темплейт содержания модального окна.

Методы:
- open(): void - открытие модального окна
- close(): void - закрытие модального окна
- closeEsc(evt: KeyboardEvent) - закрытие модального окна по кнопке Esc
- render(data: IModalData): HTMLElement - возвращает содержимое модального окна
- а также сеттеры для заполнения полей класса.

#### Класс Basket
Отвечате за отображение корзины товаров. Принимает темплейт корзины для добавления в модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.\
Поля класса:
- _list: HTMLElement - элемент разметки, в котором будут выводиться добавленные товары
- _price: HTMLElement - элемент разметки для вывода общей суммы
- button: HTMLElement - кнопка для перехода к оформлению заказа
- items: HTMLElement[] - элементы для вывода списка добавленных товаров
- totalPrice: number - общая стоимость товаров в корзине
- valid: boolean - валидация корзины.

Методы:
- сеттеры для заполнение полей класса. 

#### Класс Form
Реализует форму ввода данных пользователя. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Принимает темплейт формы для добавления в модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.\
Поля класса:
- formName: string - значение атрибута name формы
- formButton: HTMLButtonElement - кнопка подтверждения
- formErrors: HTMLElement - элемент разметки, в котором будут выводиться ошибки формы.
- valid: boolean - активность кнопки подтверждения
- error: string - данные для отображения текста ошибки в форме

Методы:
- render(data: Partial<T> & IFormState): HTMLFormElement - возвращает полное содержание формы
- а также сеттеры для заполнение полей класса.

#### Класс FormOrder
Расширяет родительский класс Form. Реализует форму ввода данных заказа. При изменении выбора способа оплаты инициирует событие изменения данных.\
Поля класса:
- _buttonsPay: HTMLButtonElement[] - массив элементов кнопок способа оплаты
- buttonPay: string - данные для выделения нужной кнопки способа оплаты
- address: string - данные для отображения в инпуте ввода адреса доставки.

Методы:
- сеттеры для заполнение полей класса.

#### Класс FormContacts
Расширяет родительский класс Form. Реализует форму ввода данных контактов пользователя.\
Поля класса:
- email: string - данные для отображения в инпуте ввода email пользователя
- phone: string - данные для отображения в инпуте ввода телефона пользователя.

Методы:
- сеттеры для заполнение полей класса.

#### Класс Confirm
Предназначен для реализации окна подтверждения корреткного оформления заказа.\
Принимает темплейт окна для добавления в модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.\
Поля класса:
- _description: HTMLElement - элемент разметки, в котором будует выводиться оплаченная сумма
- buttonSuccess: HTMLButtonElement - кнопка подтверждения
- description: number - данные для вывода оплаченной суммы.

Методы:
- сеттеры для заполнение полей класса.

#### Класс Card
Класс используется для отображения карточек на главной странице сайта, в модальном окне с подробной информацией о товаре и в корзине. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.\
Принимает темплейт карточки и экземпляр класса `EventEmitter` для возможности инициации событий.\
Поля класса:
- _productID: string - id карточки товара
- _title: HTMLElement - элемент разметки для вывода названия товара
- _price: HTMLElement - элемент разметки для вывода цены товара
- _category?: HTMLElement - элемент разметки для вывода категории товара
- _image?: HTMLImageElement - элемент разметки для вывода изображения товара
- _description?: HTMLElement - элемент разметки для вывода описания товара
- _productIndex?: HTMLElement - элемент разметки для вывода порядкового номера товара в корзине
- productActionButton?: HTMLButtonElement - кнопка добавления товара в корзину или удаления, если ранее товар уже был добавлен
- productDelete?:  HTMLButtonElement - кнопка для удаления товара из корзины.
- id: string - данные для сохранения id карточки
- title: string - данные для вывода названия товара
- price: number - данные для вывода цены товара
- category?: string - данные для вывода категории товара
- image?: string - данные для вывода изображения товара
- description?: string - данные для вывода описания товара
- productIndex?: number - данные для вывода порядкового номера товара в корзине
- productButtonInBasket: boolean - данные для изменения кнопки в зависимости от того, есть ли товар в корзине.

Методы:
- render(productData: Partial<IProductView>): HTMLElement - метод для вывода всего содержимого карточки товара
- сеттеры и геттеры для заполнения полей класса.

#### Класс Page
Отвечает за отображение блока с карточками товаров на главной странице и счетчика количества товаров в корзине.\ 
Принимает контейнер, в котором размещаются карточки товаров и экземпляр класса `EventEmitter` для возможности инициации событий.\
Поля класса:
- _catalog: HTMLElement - элемент разметки для вывода списка товаров
- _basketCounter: HTMLElement - элемент разметки для вывода количества товаров в корзине
- pageWrapper: HTMLElement - элемент страницы для блокировки прокрутки, если открыто модальное окно
- buttonBasket: HTMLButtonElement - кнопка для октрытия корзины.
- catalog: HTMLElement[] - данные для заполнения списка товаров
- basketCounter: number - данные для вывода количества товаров в корзине
- locked: boolean - блокировка страницы при открытии модального окна

Методы:
- сетеры для заполнения полей класса

### Слой коммуникации

#### Класс AppApi
Расширяет базовый родительский класс API. Класс отвечает за работу с бэкендом приложения. Производит запросы на сервер и в зависимости от метода запроса получает или передает данные.\
В конструкторе получает адреса, по которым будет происходить отправка запросов.\
Поля класса:
- cdn: string - адрес для получения контента. В приложении используются изображения.

Методы:
- getproducts(): Promise<IProduct[]> - метод для получения карточек товаров с сервера
- postOrder(order: IOrder): Promise<IOrderResult> - метод для отправки данных о заказе на сервер.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `products:changed` - изменение массива карточек товаров
- `preview:changed` - изменение открываемой в модальном окне карточки товара
- `basket:changed` - изменение массива товаров, добавленных в корзину
- `valid-user:changed` - изменение валидации данных пользователя
- `formErrors:change` - изменение валидности данных пользователя

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:select` - выбор карточки для отображения в модальном окне
- `card:submit` - событие, генерируемое при нажатии на кнопку в модальном окне товара
- `card:delete` - выбор карточки для удаления из корзины
- `basket:open` - открытие модального окна c корзиной товаров
- `basket:submit` - событие, генерируемое при нажатии на кнопку в модальном окне корзины
- `/^user\-.*:change/` - изменение полей формы или способа оплаты
- `order-button:submit` - событие, генерируемое при нажатии на кнопку в модальном окне c формой оформления заказа
- `contacts-button:submit` - событие, генерируемое при нажатии на кнопку в модальном окне c формой заполнения данных пользователя
- `confirm:submit` - событие, генерируемое при нажатии на кнопку в модальном окне с окном подтверждения
- `modal:open` - событие, генерируемое при открытие модального окна
- `modal:close` - событие, генерируемое при закрытии модального окна
